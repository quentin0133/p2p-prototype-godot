[gd_scene load_steps=7 format=3 uid="uid://clfnephye0ym8"]

[ext_resource type="PackedScene" uid="uid://jwuvmr3b1oc1" path="res://scenes/prefabs/p2p/lobby_item_UI.tscn" id="1_8uipc"]
[ext_resource type="Script" uid="uid://c2pmukp235kbh" path="res://scripts/multiplayer/p2p/lobby_list.gd" id="1_pithk"]
[ext_resource type="PackedScene" uid="uid://wgpa5am6bbcn" path="res://scenes/levels/lobby.tscn" id="4_6xt5d"]

[sub_resource type="GDScript" id="GDScript_6xt5d"]
script/source = "extends ColorRect

signal start_hosting(username: String, max_player: int);

@onready var username: LineEdit = $Background/HBoxContainer3/UsernameTextEdit;
@onready var max_player: LineEdit = $Background/HBoxContainer2/MaxPlayerTextEdit

func submit():
	username.text = username.text.strip_edges();
	if (username.text == \"\"):
		# feedback error
		return;
	if (!max_player.text.is_valid_int()):
		# feedback error
		return;
	start_hosting.emit(username.text, int(max_player.text));
"

[sub_resource type="GDScript" id="GDScript_g64qr"]
resource_name = "FormClientCode"
script/source = "extends ColorRect

signal join_lobby(username: String, id: String);

@onready var username: LineEdit = $Background/HBoxContainer3/UsernameTextEdit;
@onready var id_lobby: LineEdit = $Background/HBoxContainer2/IdLobbyTextEdit;

func submit():
	username.text = username.text.strip_edges();
	if (username.text == \"\"):
		# feedback error
		return;
	if (id_lobby.text == \"\"):
		# feedback error
		return;
	join_lobby.emit(username.text, id_lobby.text);
"

[sub_resource type="GDScript" id="GDScript_2edry"]
resource_name = "FormClientLFG"
script/source = "class_name FormClientLFG
extends Control

signal join_lobby(lobby: Lobby, username: String);

@onready var username: LineEdit = $Background/HBoxContainer3/UsernameTextEdit;

var lobby: Lobby;

func show_form(lobby: Lobby):
	self.lobby = lobby;
	visible = true;

func submit():
	username.text = username.text.strip_edges();
	if (username.text == \"\"):
		# feedback error
		return;
	join_lobby.emit(lobby, username.text);
"

[node name="Menu" type="CanvasLayer" node_paths=PackedStringArray("container")]
script = ExtResource("1_pithk")
lobby_item_UI = ExtResource("1_8uipc")
container = NodePath("LobbyList/Group/VBoxContainer/List/ScrollContainer/VBoxContainer")

[node name="LobbyList" type="ColorRect" parent="."]
anchors_preset = -1
anchor_left = 0.0703125
anchor_top = 0.0972222
anchor_right = 0.929688
anchor_bottom = 0.902778
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
color = Color(1, 1, 1, 0.501961)
metadata/_edit_use_anchors_ = true

[node name="Group" type="Control" parent="LobbyList"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 11.0
offset_top = 11.0
offset_right = -11.0005
offset_bottom = -11.0002
grow_horizontal = 2
grow_vertical = 2

[node name="VBoxContainer" type="VBoxContainer" parent="LobbyList/Group"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 10

[node name="HBoxContainer" type="HBoxContainer" parent="LobbyList/Group/VBoxContainer"]
custom_minimum_size = Vector2(0, 35)
layout_mode = 2
theme_override_constants/separation = 15

[node name="CreateLobby" type="Button" parent="LobbyList/Group/VBoxContainer/HBoxContainer"]
custom_minimum_size = Vector2(125, 0)
layout_mode = 2
theme_override_font_sizes/font_size = 14
text = "Create a lobby"

[node name="JoinLobby" type="Button" parent="LobbyList/Group/VBoxContainer/HBoxContainer"]
custom_minimum_size = Vector2(185, 0)
layout_mode = 2
theme_override_font_sizes/font_size = 14
text = "Join a lobby with a code"

[node name="Labels" type="ColorRect" parent="LobbyList/Group/VBoxContainer"]
custom_minimum_size = Vector2(0, 25)
layout_mode = 2
color = Color(0.717647, 0.717647, 0.717647, 1)

[node name="HBoxContainer" type="HBoxContainer" parent="LobbyList/Group/VBoxContainer/Labels"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.00723141
anchor_right = 0.971074
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 0
alignment = 1
metadata/_edit_use_anchors_ = true

[node name="PlayersLabel" type="Label" parent="LobbyList/Group/VBoxContainer/Labels/HBoxContainer"]
clip_contents = true
custom_minimum_size = Vector2(100, 0)
layout_mode = 2
theme_override_font_sizes/font_size = 15
text = "Players"
horizontal_alignment = 1
vertical_alignment = 1

[node name="HostLabel" type="Label" parent="LobbyList/Group/VBoxContainer/Labels/HBoxContainer"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 15
text = "Host"
horizontal_alignment = 1
vertical_alignment = 1

[node name="ActionLabel" type="Label" parent="LobbyList/Group/VBoxContainer/Labels/HBoxContainer"]
custom_minimum_size = Vector2(175, 0)
layout_mode = 2
theme_override_font_sizes/font_size = 15
text = "Action"
horizontal_alignment = 1
vertical_alignment = 1

[node name="List" type="ColorRect" parent="LobbyList/Group/VBoxContainer"]
layout_mode = 2
size_flags_vertical = 3
color = Color(0.716296, 0.716296, 0.716296, 1)

[node name="ScrollContainer" type="ScrollContainer" parent="LobbyList/Group/VBoxContainer/List"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
horizontal_scroll_mode = 0
vertical_scroll_mode = 2

[node name="VBoxContainer" type="VBoxContainer" parent="LobbyList/Group/VBoxContainer/List/ScrollContainer"]
layout_mode = 2

[node name="Lobby" parent="." instance=ExtResource("4_6xt5d")]
visible = false

[node name="FormHost" type="ColorRect" parent="."]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.501961)
script = SubResource("GDScript_6xt5d")

[node name="Background" type="ColorRect" parent="FormHost"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -189.0
offset_top = -80.0
offset_right = 189.0
offset_bottom = 80.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
color = Color(0.501961, 0.501961, 0.501961, 1)

[node name="HBoxContainer3" type="HBoxContainer" parent="FormHost/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.0608466
anchor_top = 0.163043
anchor_right = 0.933862
anchor_bottom = 0.275362
grow_horizontal = 2
grow_vertical = 2
metadata/_edit_use_anchors_ = true

[node name="UsernameLabel" type="Label" parent="FormHost/Background/HBoxContainer3"]
layout_mode = 2
text = "Your username :"
horizontal_alignment = 1

[node name="UsernameTextEdit" type="LineEdit" parent="FormHost/Background/HBoxContainer3"]
custom_minimum_size = Vector2(175, 0)
layout_mode = 2
size_flags_horizontal = 10
placeholder_text = "username123"

[node name="HBoxContainer2" type="HBoxContainer" parent="FormHost/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.0555556
anchor_top = 0.42029
anchor_right = 0.928571
anchor_bottom = 0.532609

[node name="MaxPlayerLabel" type="Label" parent="FormHost/Background/HBoxContainer2"]
layout_mode = 2
size_flags_horizontal = 0
text = "Max player :"
horizontal_alignment = 1

[node name="MaxPlayerTextEdit" type="LineEdit" parent="FormHost/Background/HBoxContainer2"]
layout_mode = 2
size_flags_horizontal = 10
placeholder_text = "4-8"
max_length = 1
virtual_keyboard_type = 2

[node name="HBoxContainer" type="HBoxContainer" parent="FormHost/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.032
anchor_top = 0.921137
anchor_right = 0.968379
anchor_bottom = 0.92131
offset_left = -0.192001
offset_top = -33.382
theme_override_constants/separation = 50
alignment = 1
metadata/_edit_use_anchors_ = true

[node name="StartHostingBtn" type="Button" parent="FormHost/Background/HBoxContainer"]
custom_minimum_size = Vector2(150, 0)
layout_mode = 2
text = "Start hosting"

[node name="CancelBtn" type="Button" parent="FormHost/Background/HBoxContainer"]
custom_minimum_size = Vector2(125, 0)
layout_mode = 2
text = "Cancel"

[node name="Lobby" type="Control" parent="FormHost/Background"]
layout_mode = 3
anchors_preset = 0

[node name="FormClientCode" type="ColorRect" parent="."]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.501961)
script = SubResource("GDScript_g64qr")

[node name="Background" type="ColorRect" parent="FormClientCode"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -189.0
offset_top = -80.0
offset_right = 189.0
offset_bottom = 80.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
color = Color(0.501961, 0.501961, 0.501961, 1)

[node name="HBoxContainer3" type="HBoxContainer" parent="FormClientCode/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.0608466
anchor_top = 0.163043
anchor_right = 0.933862
anchor_bottom = 0.275362
grow_horizontal = 2
grow_vertical = 2
metadata/_edit_use_anchors_ = true

[node name="UsernameLabel" type="Label" parent="FormClientCode/Background/HBoxContainer3"]
layout_mode = 2
text = "Your username :"
horizontal_alignment = 1

[node name="UsernameTextEdit" type="LineEdit" parent="FormClientCode/Background/HBoxContainer3"]
custom_minimum_size = Vector2(175, 0)
layout_mode = 2
size_flags_horizontal = 10
placeholder_text = "username123"

[node name="HBoxContainer2" type="HBoxContainer" parent="FormClientCode/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.0555556
anchor_top = 0.42029
anchor_right = 0.928571
anchor_bottom = 0.532609
offset_top = -0.246376
offset_bottom = 12.7826

[node name="IdLobbyLabel" type="Label" parent="FormClientCode/Background/HBoxContainer2"]
layout_mode = 2
size_flags_horizontal = 0
text = "Id du lobby :"
horizontal_alignment = 1

[node name="IdLobbyTextEdit" type="LineEdit" parent="FormClientCode/Background/HBoxContainer2"]
custom_minimum_size = Vector2(175, 0)
layout_mode = 2
size_flags_horizontal = 10
max_length = 1
virtual_keyboard_type = 2

[node name="HBoxContainer" type="HBoxContainer" parent="FormClientCode/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.032
anchor_top = 0.942
anchor_right = 0.968379
anchor_bottom = 0.942173
offset_left = -0.192001
offset_top = -33.382
theme_override_constants/separation = 50
alignment = 1
metadata/_edit_use_anchors_ = true

[node name="JoinLobbyBtn" type="Button" parent="FormClientCode/Background/HBoxContainer"]
custom_minimum_size = Vector2(150, 0)
layout_mode = 2
text = "Join the lobby"

[node name="CancelBtn" type="Button" parent="FormClientCode/Background/HBoxContainer"]
custom_minimum_size = Vector2(125, 0)
layout_mode = 2
text = "Cancel"

[node name="Lobby" type="Control" parent="FormClientCode/Background"]
layout_mode = 3
anchors_preset = 0

[node name="FormClientLFG" type="ColorRect" parent="."]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.501961)
script = SubResource("GDScript_2edry")

[node name="Background" type="ColorRect" parent="FormClientLFG"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -189.0
offset_top = -55.0
offset_right = 189.0
offset_bottom = 55.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
color = Color(0.501961, 0.501961, 0.501961, 1)

[node name="HBoxContainer3" type="HBoxContainer" parent="FormClientLFG/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.0608466
anchor_top = 0.163637
anchor_right = 0.933862
anchor_bottom = 0.445455
grow_horizontal = 2
grow_vertical = 2
metadata/_edit_use_anchors_ = true

[node name="UsernameLabel" type="Label" parent="FormClientLFG/Background/HBoxContainer3"]
layout_mode = 2
text = "Your username :"
horizontal_alignment = 1

[node name="UsernameTextEdit" type="LineEdit" parent="FormClientLFG/Background/HBoxContainer3"]
custom_minimum_size = Vector2(175, 0)
layout_mode = 2
size_flags_horizontal = 10
placeholder_text = "username123"

[node name="HBoxContainer" type="HBoxContainer" parent="FormClientLFG/Background"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.032
anchor_top = 0.942
anchor_right = 0.968379
anchor_bottom = 0.942173
offset_left = -0.192001
offset_top = -33.382
theme_override_constants/separation = 50
alignment = 1
metadata/_edit_use_anchors_ = true

[node name="JoinLobbyBtn" type="Button" parent="FormClientLFG/Background/HBoxContainer"]
custom_minimum_size = Vector2(150, 0)
layout_mode = 2
text = "Join the lobby"

[node name="CancelBtn" type="Button" parent="FormClientLFG/Background/HBoxContainer"]
custom_minimum_size = Vector2(125, 0)
layout_mode = 2
text = "Cancel"

[node name="Lobby" type="Control" parent="FormClientLFG/Background"]
layout_mode = 3
anchors_preset = 0

[connection signal="pressed" from="LobbyList/Group/VBoxContainer/HBoxContainer/CreateLobby" to="FormHost" method="set_visible" binds= [true]]
[connection signal="pressed" from="LobbyList/Group/VBoxContainer/HBoxContainer/JoinLobby" to="FormClientCode" method="set_visible" binds= [true]]
[connection signal="start_hosting" from="FormHost" to="." method="host_lobby"]
[connection signal="start_hosting" from="FormHost" to="Lobby" method="set_visible" binds= [true]]
[connection signal="start_hosting" from="FormHost" to="FormHost" method="set_visible" binds= [false]]
[connection signal="pressed" from="FormHost/Background/HBoxContainer/StartHostingBtn" to="FormHost" method="submit"]
[connection signal="pressed" from="FormHost/Background/HBoxContainer/CancelBtn" to="FormHost" method="set_visible" binds= [false]]
[connection signal="pressed" from="FormClientCode/Background/HBoxContainer/CancelBtn" to="FormClientCode" method="set_visible" binds= [false]]
[connection signal="pressed" from="FormClientLFG/Background/HBoxContainer/CancelBtn" to="FormClientLFG" method="set_visible" binds= [false]]
